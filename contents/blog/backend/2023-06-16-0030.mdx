---
title: 'ChatGPT Function Call'
authors: [ jake ]
tags: [ python, chatgpt, openai, function_call ]
---

## ğŸ¥ Function Call ì˜ˆì œ

```python
import pprint
import requests
import openai
import json


# ì‚¬ìš©í•œ í† í° ìˆ˜
used_token = 0
# API í‚¤ ì„¤ì •
openai.api_key = "YOUR_API_KEY"


class Functions:
    """í•¨ìˆ˜ë¥¼ ëª¨ì•„ë†“ì€ í´ë˜ìŠ¤"""

    @classmethod
    def get_best_book(cls, category: str = "total", range: str = "day", rank: int = 1):
        """ë„ì„œ ì¡°íšŒ"""
        url = f"https://api.co.kr/v1/best_seller?category={category}&range={range}&size=100&adult=0"
        resp = requests.get(url)
        book = resp.json().get("books")[rank - 1]
        return conversation("ì•„ë˜ ë‚´ìš©ì€ ë„ì„œì— ëŒ€í•œ ì •ë³´ì•¼. ìì—°ìŠ¤ëŸ½ê²Œ ë¬¸ì¥ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜." + str(book))


def conversation(prompt: str):
    """ì¼ë°˜ ëŒ€í™”"""
    completion = openai.ChatCompletion.create(
        model="gpt-3.5-turbo-16k",
        messages=[{"role": "user", "content": prompt}],
    )
    global used_token
    used_token += completion.usage.prompt_tokens
    return completion.choices[0].message.content


def function_conversation(prompt: str):
    """í•¨ìˆ˜ ëŒ€í™”"""
    completion = openai.ChatCompletion.create(
        model="gpt-3.5-turbo-16k",
        messages=[
            {"role": "user", "content": prompt},
        ],
        functions=[
            {
                "name": "get_best_book",
                "description": "ì¸ê¸° ë„ì„œë¥¼ ì¡°íšŒí•˜ëŠ” í•¨ìˆ˜",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "category": {
                            "type": "string",
                            "description": "ë„ì„œì˜ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”",
                            "default": "total",
                            "enum": ["total", "healing", "story", "trend", "mylife", "intellectual"]
                        },
                        "range": {
                            "type": "string",
                            "description": "ë„ì„œì˜ ì§‘ê³„ ê¸°ê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”",
                            "default": "year",
                            "enum": ["day", "week", "month", "year"]
                        },
                        "rank": {
                            "type": "integer", 
                            "description": "ëª‡ ë²ˆì§¸ ë„ì„œë¥¼ í‘œì‹œí• ì§€ ì§€ì •",
                            "max_value": 100
                        },
                    },
                    "required": ["rank"],
                },
            }
        ],
        function_call="auto",
    )
    global used_token
    used_token += completion.usage.prompt_tokens
    reply_content = completion.choices[0].message
    string_arguments = reply_content.to_dict()["function_call"]["arguments"]
    arguments = json.loads(string_arguments)
    return Functions.get_best_book(**arguments)

prompt = "ì˜¬í•´ ë‘ ë²ˆì§¸ë¡œ ì¸ê¸°ìˆëŠ” ì¢…í•© ë„ì„œ ì¶”ì²œí•´ì¤˜"
pprint.pprint(function_conversation(prompt))
print(f"({used_token}ê°œ í† í° ì‚¬ìš©)")
```
