---
title: 'Django Throttling μμ‹'
authors: [jake]
tags: [django, request, throttling]
---

## π¥ Throttling μμ‹

```python
from rest_framework.throttling import UserRateThrottle

from core.constants import THROTTLE_WHITE_LIST, THROTTLE_RATES


class OneSecondOneLimitRateThrottle(UserRateThrottle):
    """
    Custom Throttling
    GET, White List λ¥Ό μ μ™Έν• λ¨λ“  μ”μ²­μ‹
    1μ΄μ— 1νλ΅ μ ν•
    """
    scope_attr = 'throttle_scope'

    def allow_request(self, request, view) -> bool:
        """
        κ° μ”μ²­λ³„ Scope μ§€μ •
        (κ° μ”μ²­ ν΄λμ¤μ— μ‘μ„±λ throttle_classes κ°€ μ°μ„ μμ„)
        Params :
            - request(drf_request) : DRF Request
            - view(object) : νΈμ¶ κ°μ²΄
        Return(bool) : μ”μ²­ μ ν• μ μ© μ—¬λ¶€
        """
        # μμ™Έ(μ”μ²­ μ ν•μ΄ μ—†λ”) λ©λ΅
        if view.__class__.__name__ in THROTTLE_WHITE_LIST:
            return True

        # GET λ©”μ†λ“ μμ™Έ μ²λ¦¬
        if request.method == "GET":
            return True

        # μ μ €κ°€ μ—†λ” κ²½μ° μμ™Έ μ²λ¦¬
        if request.user is None \
                or not request.user.is_authenticated:
            return True

        # μ”μ²­λ³„ Scope κµ¬λ¶„
        scope = {
            "url": request.path,
            "method": request.method
        }
        self.scope = str(scope)

        # ScopeRateThrottle Default
        self.rate = self.get_rate()
        self.num_requests, self.duration = self.parse_rate(self.rate)

        return super().allow_request(request, view)

    def get_rate(self) -> str:
        """
        μ ν• rate μ§€μ •
        (settings νμΌμ— μ§€μ •ν• κ°’μ΄ μ°μ„ μμ„)
        Return(str) : Rate μ„¤μ • κ°’
        """
        # λ°ν™ κ°’ κ³ μ •
        return THROTTLE_RATES
```