---
title: 'ëª¨ë¸ í•„ë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§•'
authors: [jake]
tags: [django, model, custom, field]
---

## â­ í‚¤ì›Œë“œ

| í‚¤ì›Œë“œ | ì„¤ëª… |
| --- | --- |
| field | ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ì˜ ì†ì„± |

## ğŸ¥ ì˜ˆì‹œ(íœ´ëŒ€í° ë²ˆí˜¸ í•„ë“œ)

```python
from django.db.models import CharField
from django.utils.translation import gettext_lazy as _
from encrypted_fields.fields import EncryptedFieldMixin, SearchField

class PhoneNumberValidation:
    """
    íœ´ëŒ€í° ë²ˆí˜¸ ìœ íš¨ì„± ê²€ì‚¬
    """
    def _length_validate(self, value):
        # êµ­ë‚´ íœ´ëŒ€í° ë²ˆí˜¸ ìë¦¬ìˆ˜ í™•ì¸
        if not 9 < len(value) < 12:
            raise Exception('The length of the value must be 10, 11.')
        return value

    def _type_validate(self, value):
        # ìˆ«ìì¸ì§€ í™•ì¸
        if not str(value).isdecimal():
            raise Exception('Type Error')
        return value

    def phone_number_validate(self, value):
        if value is not None:
            # ë¶ˆí•„ìš”í•œ ë¬¸ì ì œê±°
            value = str(value).replace('-', '').strip()
            value = self._length_validate(value)
            value = self._type_validate(value)
        return value

class PhoneNumberField(CharField, PhoneNumberValidation):
    """
    íœ´ëŒ€í° ë²ˆí˜¸ ê¸°ë³¸ í•„ë“œ
    """
    description = _("Phone Number")

    def __init__(self, *args, **kwargs):
        kwargs.setdefault('max_length', 15)
        super().__init__(*args, **kwargs)

    @classmethod
    def _set_phone_number_format(cls, value):
        if value is None:
            return value
        # ìë¦¬ìˆ˜ë³„ í¬ë©§ ì ìš©
        if len(value) == 11:
            return f'{value[:3]}-{value[3:7]}-{value[7:]}'
        elif len(value) == 10:
            return f'{value[:3]}-{value[3:6]}-{value[6:]}'
        else:
            return value

    def get_prep_value(self, value):
        """
        ë°ì´í„° ì €ì¥ ì „ ìˆ˜ì •
        """
        value = self.phone_number_validate(value)
        value = self.to_python(value)
        return super().get_prep_value(value)

    def from_db_value(self, value, expression, connection):
        """
        ë°ì´í„° í˜¸ì¶œ ì‹œ ìˆ˜ì •
        """
        return self._set_phone_number_format(self.to_python(value)) if value else None

class PhoneNumberSearchField(SearchField, PhoneNumberValidation):
    """
    íœ´ëŒ€í° ë²ˆí˜¸ ê²€ìƒ‰ í•„ë“œ
    """
    def get_prep_value(self, value):
        """
        ë°ì´í„° ì €ì¥ ì „ ìˆ˜ì •
        """
        value = self.phone_number_validate(value)
        return super().get_prep_value(value)

class PhoneNumberEncryptedField(EncryptedFieldMixin, PhoneNumberField):
    """
    íœ´ëŒ€í° ë²ˆí˜¸ ì•”í˜¸í™” í•„ë“œ
    """
    def from_db_value(self, value, expression, connection):
        """
        ë°ì´í„° í˜¸ì¶œ ì‹œ ìˆ˜ì •
        """
        value = super().from_db_value(value, expression, connection)
        return self._set_phone_number_format(value)
```
