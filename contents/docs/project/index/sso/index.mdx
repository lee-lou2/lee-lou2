---
title: SSO Server
sidebar_label: SSO ì„œë²„
description: OAuth2.0 + OIDC ë¥¼ ì´ìš©í•œ SSO ì„œë²„ êµ¬ì¶•
sidebar_position: 2
---

import styles from './index.module.css';

# ğŸ« SSO Server

:::tip
OAuth2.0 SSO Server êµ¬ì¶•
:::

## ìš©ì–´.

---

<div className={styles.docsSSOWord}>
    <div>
        <details>
            <summary><strong>OAuth2</strong></summary>
            <div>
                <div>OAuth 2.0ì€ ì œ3ì ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ ì—†ì´ ì‚¬ìš©ìê°€ ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” í”„ë¡œí† ì½œì…ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ ì¸ê°€ ì„œë²„ê°€ ì‚¬ìš©ìì—ê²Œ ê¶Œí•œì„ ìš”ì²­í•˜ê³ , ì‚¬ìš©ìê°€ ìŠ¹ì¸í•œ í›„, ì¸ì¦ ì½”ë“œë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤. ì´ ì¸ì¦ ì½”ë“œë¥¼ ì´ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°œê¸‰í•˜ê³ , ì´ë¥¼ ì´ìš©í•˜ì—¬ ë³´í˜¸ëœ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. OAuth 2.0ì€ ì—¬ëŸ¬ ê°€ì§€ ê¶Œí•œ ë¶€ì—¬ ë°©ì‹(grant type)ì„ ì§€ì›í•˜ë©°, ê·¸ì¤‘ì—ì„œë„ ê°€ì¥ ì¼ë°˜ì ì´ê³  ì•ˆì „í•œ Authorization Code Grant ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.</div>
            </div>
        </details>
    </div>
    <div>
        <details>
            <summary><strong>OIDC</strong></summary>
            <div>
                <div>OpenID Connect(OIDC)ëŠ” OAuth 2.0 í”„ë¡œí† ì½œì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‚¬ìš©ì ì¸ì¦ ë° ì¸ê°€ í”„ë¡œí† ì½œì…ë‹ˆë‹¤. OIDCëŠ” OAuth 2.0ê³¼ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ê³ , í´ë¼ì´ì–¸íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•´ ì¸ì¦ ê³¼ì •ì„ ê±°ì¹  ìˆ˜ ìˆë„ë¡ ì§€ì›í•©ë‹ˆë‹¤. OIDCëŠ” ê¸°ì¡´ì˜ OAuth 2.0 ë°©ì‹ì—ì„œ ì‚¬ìš©ì ì¸ì¦ì„ ìœ„í•œ í‘œì¤€í™”ëœ ë°©ì‹ì„ ì œê³µí•¨ìœ¼ë¡œì¨, ë³´ì•ˆì„±ê³¼ í¸ì˜ì„±ì„ ëª¨ë‘ í™•ë³´í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.</div>
            </div>
        </details>
    </div>
</div>
<div className={styles.docsSSOWord}>
    <div>
        <details>
            <summary><strong>SSO</strong></summary>
            <div>
                <div>SSOëŠ” Single Sign-Onì˜ ì•½ì–´ë¡œ, ì‚¬ìš©ìê°€ ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ì„œë¹„ìŠ¤ì— ë¡œê·¸ì¸í•  ë•Œë§ˆë‹¤ ê°ê° ì¸ì¦ì„ ë°›ëŠ” ëŒ€ì‹ , í•œ ë²ˆì˜ ë¡œê·¸ì¸ìœ¼ë¡œ ì—¬ëŸ¬ ì• í”Œë¦¬ì¼€ì´ì…˜ ë˜ëŠ” ì„œë¹„ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì¸ì¦ ë°©ì‹ì…ë‹ˆë‹¤. SSOë¥¼ êµ¬í˜„í•˜ë ¤ë©´ ì¼ë°˜ì ìœ¼ë¡œ OAuth 2.0 ë° OpenID Connect(OIDC)ê³¼ ê°™ì€ ì¸ì¦ ë° ì¸ê°€ í”„ë¡œí† ì½œì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</div>
            </div>
        </details>
    </div>
    <div></div>
</div>


## Grant Type.

---

| ì¢…ë¥˜                                      | ì„¤ëª…                                                                                                                            | ë¹„ê³  |
|-----------------------------------------|-------------------------------------------------------------------------------------------------------------------------------|----|
| Authorization Code                      | â€¢ ê°€ì¥ **ì¼ë°˜ì **ì´ê³  ì•ˆì „í•œ ë°©ë²•     <br/>â€¢ ì‚¬ìš©ìê°€ ì¸ì¦ ì„œë²„ì— ì¸ì¦í•˜ê³ , ì¸ê°€ëœ ì‘ìš© í”„ë¡œê·¸ë¨ì´ ì¸ì¦ ì½”ë“œë¥¼ ë°›ìŒ <br/>â€¢ `ì¸ì¦ ì½”ë“œ`ë¥¼ ì´ìš©í•˜ì—¬ `ì•¡ì„¸ìŠ¤ í† í°`ì„ ìš”ì²­í•˜ê³ , ì´ë¥¼ ì´ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ |    |
| Implicit                                | â€¢ Authorization Code Grantì™€ ìœ ì‚¬í•˜ì§€ë§Œ, ì¸ì¦ ì½”ë“œ ëŒ€ì‹  ì•¡ì„¸ìŠ¤ í† í°ì„ ë°”ë¡œ ë°›ìŒ <br/>â€¢ **ì‚¬ìš©ìì˜ ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ìš”ì²­**ë˜ë¯€ë¡œ, ë³´ì•ˆì„±ì´ ë‚®ìŒ                             |    |
| Resource Owner<br/>Password Credentials | â€¢ ì‚¬ìš©ìì˜ `ì•„ì´ë””`ì™€ `íŒ¨ìŠ¤ì›Œë“œ`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°”ë¡œ ë°›ìŒ <br/>â€¢ ë³´ì•ˆì„±ì´ ë‚®ìœ¼ë¯€ë¡œ, **ê¶Œì¥ë˜ì§€ ì•ŠëŠ” ë°©ë²•**                                                         |    |
| Client Credentials                      | â€¢ í´ë¼ì´ì–¸íŠ¸ê°€ ì§ì ‘ ì•¡ì„¸ìŠ¤ í† í°ì„ ë°›ìŒ <br/>â€¢ ì‚¬ìš©ìì™€ ê´€ë ¨ì´ ì—†ëŠ” ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ì— ì‚¬ìš©                                                                     |    |

<br/>

## SSO ì„œë²„ êµ¬ì¡°.
---

![img1](./img/sso_server.png)

## ì‚¬ì´íŠ¸ ì •ë³´

**ğŸ’» ì†ŒìŠ¤ì½”ë“œ** : https://github.com/lee-lou2/sso


## ê¸°ëŠ¥

- ì‚¬ìš©ì ë“±ë¡ ë° ë¡œê·¸ì¸
- ì‚¬ìš©ì ì¸ì¦ ì •ë³´ì˜ ì¤‘ì•™ ì§‘ì¤‘ ê´€ë¦¬
- ë‹¤ì¤‘ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ SSO ì§€ì›

## ìš”êµ¬ ì‚¬í•­

- Python 3.x
- Django 3.x

## ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬

- django-oauth-toolkit
- allauth

## ì„¤ì¹˜

1. ë¦¬í¬ì§€í† ë¦¬ë¥¼ í´ë¡ í•©ë‹ˆë‹¤.

```
git clone https://github.com/lee-lou2/sso
```

2. ê°€ìƒ í™˜ê²½ì„ ë§Œë“¤ê³  í™œì„±í™”í•©ë‹ˆë‹¤.

```
python3 -m venv venv
source venv/bin/activate
```

3. ì¢…ì†ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
cd sso
pip install -r requirements.txt
```

4. í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```
# .env.sample í‚¤ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ ì‘ì„±í•©ë‹ˆë‹¤
```

5. ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜í•©ë‹ˆë‹¤.

```
python manage.py migrate
```

6. ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```
python manage.py runserver
```

7. ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8000`ìœ¼ë¡œ ì ‘ì†í•˜ì—¬ ì„œë²„ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

## ì„¤ì •

### SSO í´ë¼ì´ì–¸íŠ¸ ë“±ë¡

1. í´ë¼ì´ì–¸íŠ¸ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
    1)  {SERVER}/oauth2/applications/

- `name`: í´ë¼ì´ì–¸íŠ¸ ì´ë¦„
- `client_id`: í´ë¼ì´ì–¸íŠ¸ ì‹ë³„ì
- `client_secret`: í´ë¼ì´ì–¸íŠ¸ ë¹„ë°€ í‚¤
- `Redirect uris`: í´ë¼ì´ì–¸íŠ¸ì˜ ì½œë°± URL
- `Client type`: Confidential ì„ íƒ
- `Authorization grant type`: Authorization code ì„ íƒ
- `Algorithm`: RSA ì„ íƒ

### ê¸°íƒ€ ì„¤ì •

- `SECRET_KEY`: Django ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë¹„ë°€ í‚¤
- `ALLOWED_HOSTS`: í—ˆìš©ëœ í˜¸ìŠ¤íŠ¸ ë¦¬ìŠ¤íŠ¸

## ì‚¬ìš©ë²•

### [ Golang ]

1. ë¡œê·¸ì¸ í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰ì…˜ ë§í¬ ìƒì„±

```go
// GetRedirectUri ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸í•  URIë¥¼ ë°˜í™˜
func GetRedirectUri() (string, error) {
	codeVerifier, err := getCodeVerifier()
	if err != nil {
		return "", err
	}
	codeChallenge := getCodeChallenge(codeVerifier)

	redirectURI := fmt.Sprintf(
		"%s/oauth2/authorize/?"+
			"response_type=code&"+
			"code_challenge=%s&"+
			"code_challenge_method=S256&"+
			"client_id=%s&"+
			"redirect_uri=%s&"+
			"state=%s",
		os.Getenv("OAUTH2_SSO_SERVER_HOST"),
		url.QueryEscape(codeChallenge),
		url.QueryEscape(os.Getenv("OAUTH2_CLIENT_ID")),
		url.QueryEscape(os.Getenv("OAUTH2_CALLBACK_URL")),
		url.QueryEscape(codeVerifier),
	)
	return redirectURI, nil
}
```

2. ë¡œê·¸ì¸ í›„ Authorization code ë°œê¸‰


3. ì½”ë“œë¥¼ ì´ìš©í•´ í† í° ë°œê¸‰

```go

// tokenResponse í† í° ì‘ë‹µ
type tokenResponse struct {
	AccessToken  string `json:"access_token"`
	ExpiresIn    int    `json:"expires_in"`
	TokenType    string `json:"token_type"`
	Scope        string `json:"scope"`
	RefreshToken string `json:"refresh_token"`
	IdToken      string `json:"id_token"`
}

// GetToken í† í° ê°€ì ¸ì˜¤ê¸°
func GetToken(code, state string) (*tokenResponse, error) {
	var respData tokenResponse

	data := url.Values{}
	data.Set("client_id", os.Getenv("OAUTH2_CLIENT_ID"))
	data.Set("client_secret", os.Getenv("OAUTH2_CLIENT_SECRET"))
	data.Set("code", code)
	data.Set("code_verifier", state)
	data.Set("redirect_uri", os.Getenv("OAUTH2_CALLBACK_URL"))
	data.Set("grant_type", "authorization_code")
	payload := strings.NewReader(data.Encode())

	// ìš”ì²­
	resp, _ := requests.Http(
		"POST",
		os.Getenv("OAUTH2_SSO_SERVER_HOST")+"/oauth2/token/",
		payload,
		&requests.Header{
			Key:   "Cache-Control",
			Value: "no-cache",
		},
		&requests.Header{
			Key:   "Content-Type",
			Value: "application/x-www-form-urlencoded",
		},
	)
	if resp.StatusCode != 200 {
		return nil, fmt.Errorf("í† í° ì¡°íšŒë¥¼ ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤ : %s", resp.Body)
	}
	if err := json.Unmarshal([]byte(resp.Body), &respData); err != nil {
		return nil, err
	}
	return &respData, nil
}
```

3. í† í°ì„ ì´ìš©í•´ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ë“± í™œìš©